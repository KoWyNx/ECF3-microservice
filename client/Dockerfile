FROM node:14-alpine

WORKDIR /app

COPY package.json yarn.lock ./

RUN yarn install

COPY . .

ARG REACT_APP_AUTHENTICATION_SERVICE_URL
ARG REACT_APP_COMMON_DATA_SERVICE_URL
ARG REACT_APP_PAYMENT_SERVICE_URL
ARG REACT_APP_SEARCH_SUGGESTION_SERVICE_URL
ARG REACT_APP_ENVIRONMENT

ENV REACT_APP_AUTHENTICATION_SERVICE_URL=$REACT_APP_AUTHENTICATION_SERVICE_URL
ENV REACT_APP_COMMON_DATA_SERVICE_URL=$REACT_APP_COMMON_DATA_SERVICE_URL
ENV REACT_APP_PAYMENT_SERVICE_URL=$REACT_APP_PAYMENT_SERVICE_URL
ENV REACT_APP_SEARCH_SUGGESTION_SERVICE_URL=$REACT_APP_SEARCH_SUGGESTION_SERVICE_URL
ENV REACT_APP_ENVIRONMENT=$REACT_APP_ENVIRONMENT

RUN yarn build

RUN yarn global add serve

EXPOSE 3000

CMD ["node", "server.js"]
